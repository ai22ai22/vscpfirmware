<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>SBC68EC Web Server: ex_httpexecgetcmd.c</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.2 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
  </ul>
</div>
<h1>ex_httpexecgetcmd.c</h1>Consider the HTML page "power.cgi", as displayed by a remote browser:<p>
<div class="fragment"><pre class="fragment">
&lt;html&gt;&lt;body&gt;
    &lt;FORM METHOD=GET action=POWER.CGI&gt;
    &lt;table&gt;
        &lt;tr&gt;
            &lt;td&gt;Power Level:&lt;/td&gt;
            &lt;td&gt;&lt;input type=text size=2 maxlength=1 name=P value=%p07&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;Low Power Setting:&lt;/td&gt;
            &lt;td&gt;&lt;input type=text size=2 maxlength=1 name=L value=%p08&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td&gt;High Power Setting:&lt;/td&gt;
            &lt;td&gt;&lt;input type=text size=2 maxlength=1 name=H value=%p09&gt;&lt;/td&gt;
        &lt;/tr&gt;
        &lt;tr&gt;
            &lt;td colspan=2&gt;&lt;input type=submit name=B value=Apply&gt;&lt;/td&gt;
        &lt;/tr&gt;
    &lt;/table&gt;
    &lt;/form&gt;
&lt;/body&gt;&lt;/html&gt;
</pre></div><p>
This page displays a table with labels in the first column and text box values in the second column. The first row, first column cell contains the string "Power Level". The second column is a text box to display and modify the power level value. The last row contains a button labelled "Apply". A user viewing this page has the ability to modify the value in the Power Level text box and click on "Apply" button to submit the new power level value to the Modtronix SBC68EC Web Server. Assume that a user enters values of ‘5’, ‘1’ and ‘9’ in Power Level, Low Power Setting and High Power Setting text boxes respectively, then clicks on the "Apply" button. The browser would create a HTTP request string "POWER.CGI?P=5&amp;L=1&amp;H=9" and send it to the HTTP server. The server in turn calls the <a class="el" href="http_8h.html#e7308dd0acc72aa6195e6cdd78bd5af3">HTTPExecGetCmd()</a> callback function.<p>
The main application implements HTTPExecGetCmd as below:<p>
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00042"></a>00042 <span class="preprocessor">#include "<a class="code" href="projdefs_8h.html" title="Project configuration.">projdefs.h</a>"</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include "<a class="code" href="http_8h.html" title="HTTP Module for Modtronix TCP/IP Stack.">net\http.h</a>"</span>
<a name="l00044"></a>00044 
<a name="l00045"></a>00045 
<a name="l00055"></a>00055 <span class="keywordtype">void</span> <a name="a0"></a><a class="code" href="http_8h.html#e7308dd0acc72aa6195e6cdd78bd5af3">HTTPExecGetCmd</a>(<a name="_a1"></a><a class="code" href="struct___h_t_t_p___i_n_f_o.html">HTTP_INFO</a>* httpInfo, <a name="a2"></a><a class="code" href="compiler_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a>* rqstRes)
<a name="l00056"></a>00056 {
<a name="l00057"></a>00057     <a class="code" href="compiler_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a> param[20];
<a name="l00058"></a>00058     <span class="keywordtype">int</span> PowerLevel, LowPowerSetting, HighPowerSetting;
<a name="l00059"></a>00059 
<a name="l00060"></a>00060     <span class="comment">//Used as input AND output parameter for HTTPGetParams.</span>
<a name="l00061"></a>00061     <span class="comment">// - Input parameter indicates size of param buffer</span>
<a name="l00062"></a>00062     <span class="comment">// - On return of HTTPGerParam() valueIdx will contain index of value string in param</span>
<a name="l00063"></a>00063     <a class="code" href="compiler_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a> valueIdx;
<a name="l00064"></a>00064     <a class="code" href="compiler_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a> moreParams;
<a name="l00065"></a>00065 
<a name="l00066"></a>00066     <span class="comment">//Get next name-value parameter until we have retrieved them all</span>
<a name="l00067"></a>00067     <span class="keywordflow">do</span> {
<a name="l00068"></a>00068         valueIdx = (<a class="code" href="compiler_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a>)<span class="keyword">sizeof</span>(param);   <span class="comment">//Input parameter is size of param buffer</span>
<a name="l00069"></a>00069 
<a name="l00070"></a>00070         <span class="comment">//Get name-value parameters. Returns true if there are more name-value</span>
<a name="l00071"></a>00071         <span class="comment">//parameters to follow</span>
<a name="l00072"></a>00072         <span class="comment">//- Pointer to Name parameter = &amp;param[0]</span>
<a name="l00073"></a>00073         <span class="comment">//- Pointer to Value parameter = &amp;param[valueIdx]</span>
<a name="l00074"></a>00074         moreParams = <a name="a3"></a><a class="code" href="http_8h.html#a5fd250a77a5b2909f67ab54b3bad1b7">HTTPGetParam</a>(httpInfo-&gt;<a name="a4"></a><a class="code" href="struct___h_t_t_p___i_n_f_o.html#5cb9fea0ece4d3ef7f82721f36df95fe">socket</a>, param, &amp;valueIdx);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="comment">//Identify parameter - param[0] contains the first character of the name part</span>
<a name="l00077"></a>00077         <span class="keywordflow">if</span> ( param[0] == <span class="charliteral">'P'</span>) <span class="comment">// Is this power level?</span>
<a name="l00078"></a>00078         {
<a name="l00079"></a>00079             <span class="comment">//The value is the Power level value. The value string is = &amp;param[valueIdx]</span>
<a name="l00080"></a>00080             PowerLevel = atoi((<span class="keywordtype">char</span>*)&amp;param[valueIdx]);
<a name="l00081"></a>00081         }
<a name="l00082"></a>00082         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( param[0] == <span class="charliteral">'L'</span>) <span class="comment">// Is this Low Power Setting?</span>
<a name="l00083"></a>00083             LowPowerSetting = atoi((<span class="keywordtype">char</span>*)&amp;param[valueIdx]);
<a name="l00084"></a>00084         <span class="keywordflow">else</span> <span class="keywordflow">if</span> ( param[0] == <span class="charliteral">'H'</span> ) <span class="comment">// Is this High Power Setting?</span>
<a name="l00085"></a>00085             HighPowerSetting = atoi((<span class="keywordtype">char</span>*)&amp;param[valueIdx]);
<a name="l00086"></a>00086     } <span class="keywordflow">while</span> (moreParams);
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     <span class="comment">// If another page is to be displayed as a result of this command, copy</span>
<a name="l00090"></a>00090     <span class="comment">// its upper case name into rqstRes.</span>
<a name="l00091"></a>00091     <span class="comment">//strcpy(rqstRes, "RESULTS.CGI");</span>
<a name="l00092"></a>00092 }
<a name="l00093"></a>00093 
</pre></div> <hr size="1"><address style="text-align: right;"><small>Generated on Mon Jul 9 08:38:50 2007 for SBC68EC Web Server by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.2 </small></address>
</body>
</html>
