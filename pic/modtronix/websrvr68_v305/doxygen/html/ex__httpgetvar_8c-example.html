<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SBC68EC Web Server: ex_httpgetvar.c</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
  </ul></div>
<h1>ex_httpgetvar.c</h1>Assume that the page "status.cgi" needs to display the serial number of the HTTP Web server device. The page "status.cgi" being served by the HTTP Server contains the following HTML line:<p>
 
Serial Number=%S01
<p>
The 'S' is the Variable Group and the '01' is the VarValue in uppercase hex. During processing of this file, the HTTP Server encounters the ‘%S01’ string. After parsing it, the HTTP Server makes a callback to HTTPGetVar(httpInfo, val). The httpInfo-&gt;var.get.varRef will have the value HTTP_START_OF_VAR. The main user application implements HTTPGetVar as follows:<p>
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00018"></a>00018 <span class="preprocessor">#include "<a class="code" href="projdefs_8h.html">projdefs.h</a>"</span>
<a name="l00019"></a>00019 <span class="preprocessor">#include "<a class="code" href="http_8h.html">net\http.h</a>"</span>
<a name="l00020"></a>00020 
<a name="l00021"></a>00021 <a name="a17"></a><a class="code" href="compiler_8h.html#408c4c066164afa1b6aa3f804c3d3528">ROM</a> <span class="keywordtype">char</span> <a name="a18"></a><a class="code" href="ex__httpgetvar_8c.html#d3633a5b5d908be97e76dfa5cbe2ac45">SerialNumberStr</a>[] = <span class="stringliteral">"123456SER"</span>;
<a name="l00022"></a>00022 
<a name="l00023"></a>00023 <a name="a19"></a><a class="code" href="compiler_8h.html#2b0e863dadf920709ec53d9088ee7c91">WORD</a> <a name="a20"></a><a class="code" href="http_8h.html#015c5b9453668f6d32ada2d7bb20663f">HTTPGetVar</a>(<a name="_a21"></a><a class="code" href="struct___h_t_t_p___i_n_f_o.html">HTTP_INFO</a>* httpInfo, <a name="a22"></a><a class="code" href="compiler_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a>* val)
<a name="l00024"></a>00024 {
<a name="l00025"></a>00025     <a class="code" href="compiler_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a> varValue, varGroup, ref;
<a name="l00026"></a>00026 
<a name="l00027"></a>00027     varValue = httpInfo-&gt;<a name="a23"></a><a class="code" href="struct___h_t_t_p___i_n_f_o.html#3a877a260355f2ddf240626008d320b1">var</a>.<a name="a24"></a><a class="code" href="struct___h_t_t_p___i_n_f_o.html#662858396253f999d8f589bc0fc807e6">get</a>.tagVal;        <span class="comment">//Variable Value of requested variable</span>
<a name="l00028"></a>00028     varGroup = httpInfo-&gt;<a class="code" href="struct___h_t_t_p___i_n_f_o.html#3a877a260355f2ddf240626008d320b1">var</a>.<a class="code" href="struct___h_t_t_p___i_n_f_o.html#662858396253f999d8f589bc0fc807e6">get</a>.tagGroup;      <span class="comment">//Variable Group of requested variable</span>
<a name="l00029"></a>00029     ref      = httpInfo-&gt;<a class="code" href="struct___h_t_t_p___i_n_f_o.html#3a877a260355f2ddf240626008d320b1">var</a>.<a class="code" href="struct___h_t_t_p___i_n_f_o.html#662858396253f999d8f589bc0fc807e6">get</a>.varRef;        <span class="comment">//Current callback reference with respect</span>
<a name="l00030"></a>00030                                                 <span class="comment">// to 'var' variable.</span>
<a name="l00031"></a>00031     
<a name="l00032"></a>00032 
<a name="l00033"></a>00033     <span class="comment">//In case requested var not found, set it to NULL character and return HTTP_END_OF_VAR</span>
<a name="l00034"></a>00034     *val = <span class="charliteral">'\0'</span>;    
<a name="l00035"></a>00035     
<a name="l00036"></a>00036     <span class="comment">//Identify variable group</span>
<a name="l00037"></a>00037     <span class="keywordflow">if</span> (varGroup == <span class="charliteral">'S'</span>)
<a name="l00038"></a>00038     {
<a name="l00039"></a>00039         <span class="comment">// Identify variable value.</span>
<a name="l00040"></a>00040         <span class="keywordflow">if</span> ( varValue == 0x01 )
<a name="l00041"></a>00041         {
<a name="l00042"></a>00042             <span class="comment">// Serial Number is a NULL terminated string.</span>
<a name="l00043"></a>00043             <span class="comment">// First of all determine, if this is very first call.</span>
<a name="l00044"></a>00044             <span class="keywordflow">if</span> ( ref == <a name="a25"></a><a class="code" href="http_8h.html#baa678b74521a4ad2e94d354eaa262b2">HTTP_START_OF_VAR</a> )
<a name="l00045"></a>00045             {
<a name="l00046"></a>00046                 <span class="comment">// This is the first call. Initialize index to SerialNumber</span>
<a name="l00047"></a>00047                 <span class="comment">// string. We are using ref as our index.</span>
<a name="l00048"></a>00048                 ref = (<a class="code" href="compiler_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a>)0;
<a name="l00049"></a>00049             }
<a name="l00050"></a>00050             
<a name="l00051"></a>00051             <span class="comment">// Now access byte at current index and save it in buffer.</span>
<a name="l00052"></a>00052             *val = <a class="code" href="ex__httpgetvar_8c.html#d3633a5b5d908be97e76dfa5cbe2ac45">SerialNumberStr</a>[(<a class="code" href="compiler_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a>)ref];
<a name="l00053"></a>00053             
<a name="l00054"></a>00054             <span class="comment">// Did we reach end of string?</span>
<a name="l00055"></a>00055             <span class="keywordflow">if</span> ( *val == ‘\0’ )
<a name="l00056"></a>00056             {
<a name="l00057"></a>00057                 <span class="comment">// Yes, we are done transferring the string.</span>
<a name="l00058"></a>00058                 <span class="comment">// Return with HTTP_END_OF_VAR to notify HTTP server that we</span>
<a name="l00059"></a>00059                 <span class="comment">// are finished transferring the value.</span>
<a name="l00060"></a>00060                 <span class="keywordflow">return</span> <a name="a26"></a><a class="code" href="http_8h.html#c91480d44279d692b402a044f8c7d99f">HTTP_END_OF_VAR</a>;
<a name="l00061"></a>00061             } 
<a name="l00062"></a>00062             <span class="comment">// Or else, increment array index and return it to HTTP server.</span>
<a name="l00063"></a>00063             (<a class="code" href="compiler_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a>)ref++;
<a name="l00064"></a>00064             <span class="comment">// Since value of ref is not HTTP_END_OF_VAR, HTTP server will call</span>
<a name="l00065"></a>00065             <span class="comment">// us again for rest of the value.</span>
<a name="l00066"></a>00066             <span class="keywordflow">return</span> ref;
<a name="l00067"></a>00067         }
<a name="l00068"></a>00068         <span class="keywordflow">else</span> {
<a name="l00069"></a>00069             <span class="comment">// Check for other variables values...</span>
<a name="l00070"></a>00070         }
<a name="l00071"></a>00071     }
<a name="l00072"></a>00072 }
<a name="l00073"></a>00073 
</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Mon Oct 9 11:35:13 2006 for SBC68EC Web Server by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
