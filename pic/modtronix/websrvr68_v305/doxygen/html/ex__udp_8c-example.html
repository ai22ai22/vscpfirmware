<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>SBC68EC Web Server: ex_udp.c</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.4.7 -->
<div class="tabs">
  <ul>
    <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
    <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
    <li><a href="examples.html"><span>Examples</span></a></li>
  </ul></div>
<h1>ex_udp.c</h1>The following example will create a UDP socket that listens to port 54123. If anything is received on this port, it will check the first byte of the received data. If it is 1, it will set the system LED (Port B6), if 0, it will clear the system LED.<p>
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="preprocessor">#include "<a class="code" href="udp_8h.html">net\udp.h</a>"</span>
<a name="l00009"></a>00009 
<a name="l00010"></a>00010 <span class="comment">//Create a UDP socket for receiving and sending data</span>
<a name="l00011"></a>00011 <span class="keyword">static</span> <a name="a116"></a><a class="code" href="udp_8h.html#74f1b6fad75426b918419bbf943179c3">UDP_SOCKET</a> udpSocketUser = <a name="a117"></a><a class="code" href="udp_8h.html#f3fe6dcf14261c22ec007372716f5e94">INVALID_UDP_SOCKET</a>;
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="keywordtype">void</span> <a name="a118"></a><a class="code" href="ex__udp_8c.html#40a3c127fa1f9c435c5ad46f9789e143">udpExample</a>(<span class="keywordtype">void</span>)
<a name="l00015"></a>00015 {
<a name="l00016"></a>00016     <a name="a119"></a><a class="code" href="compiler_8h.html#4ae1dab0fb4b072a66584546209e7d58">BYTE</a> c;
<a name="l00017"></a>00017     <a name="_a120"></a><a class="code" href="struct___n_o_d_e___i_n_f_o.html">NODE_INFO</a> udpServerNode;
<a name="l00018"></a>00018 
<a name="l00019"></a>00019     <span class="comment">//Initialize remote IP and MAC address of udpServerNode with 0, seeing that we</span>
<a name="l00020"></a>00020     <span class="comment">//don't know them for the node that will send us an UDP message. The first time</span>
<a name="l00021"></a>00021     <span class="comment">//a message is received addressed to this port, the remote IP and MAC addresses</span>
<a name="l00022"></a>00022     <span class="comment">//are automatically updated with the addresses of the remote node.</span>
<a name="l00023"></a>00023     <a name="a121"></a><a class="code" href="helpers_8h.html#82727f816ad4405616b0932aded64f4c">memclr</a>(&amp;udpServerNode, <span class="keyword">sizeof</span>(udpServerNode));
<a name="l00024"></a>00024 
<a name="l00025"></a>00025     <span class="comment">//Configure for local port 54123 and remote port INVALID_UDP_PORT. This opens</span>
<a name="l00026"></a>00026     <span class="comment">//the socket to listen on the given port.</span>
<a name="l00027"></a>00027     udpSocketUser = <a name="a122"></a><a class="code" href="udp_8h.html#56465092428f64eb5654e14a721812e8">UDPOpen</a>(54123, &amp;udpServerNode, <a name="a123"></a><a class="code" href="udp_8h.html#e506feb8cfca5f3db75f8c9d4cf3e848">INVALID_UDP_PORT</a>);
<a name="l00028"></a>00028     
<a name="l00029"></a>00029     <span class="comment">//An error occurred during the UDPOpen() function</span>
<a name="l00030"></a>00030     <span class="keywordflow">if</span> (udpSocketUser == <a class="code" href="udp_8h.html#f3fe6dcf14261c22ec007372716f5e94">INVALID_UDP_SOCKET</a>) {
<a name="l00031"></a>00031         <span class="comment">//Add user code here to take action if required!</span>
<a name="l00032"></a>00032     }
<a name="l00033"></a>00033 
<a name="l00034"></a>00034     <span class="comment">//Infinite loop. Check if anything is received on UDP port</span>
<a name="l00035"></a>00035     <span class="keywordflow">while</span>(1)
<a name="l00036"></a>00036     {
<a name="l00037"></a>00037         <span class="comment">//Is there any data waiting for us on the UDP socket?</span>
<a name="l00038"></a>00038         <span class="comment">//Because of the design of the Modtronix TCP/IP stack we have to consume</span>
<a name="l00039"></a>00039         <span class="comment">//all data sent to us as soon as we detect it.</span>
<a name="l00040"></a>00040         <span class="keywordflow">if</span> (<a name="a124"></a><a class="code" href="udp_8h.html#b83fffbe73e7895fe5efc246ccd752cb">UDPIsGetReady</a>(udpSocketUser)) {
<a name="l00041"></a>00041 
<a name="l00042"></a>00042             <span class="comment">//We are only interrested in the first byte of the message.</span>
<a name="l00043"></a>00043             <a name="a125"></a><a class="code" href="udp_8h.html#4292b49f8ba04393a7b301123108613c">UDPGet</a>(&amp;c);
<a name="l00044"></a>00044             
<a name="l00045"></a>00045             <span class="keywordflow">if</span> (c == <span class="charliteral">'0'</span>) <a name="a126"></a><a class="code" href="compiler_8h.html#1ab0d9c536690df4453f409615b756a1">LATB6</a> = 0;        <span class="comment">//Switch system LED off</span>
<a name="l00046"></a>00046             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">'1'</span>) <a class="code" href="compiler_8h.html#1ab0d9c536690df4453f409615b756a1">LATB6</a> = 1;   <span class="comment">//Switch system LED on</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048             <span class="comment">//Discard the socket buffer.</span>
<a name="l00049"></a>00049             <a name="a127"></a><a class="code" href="udp_8h.html#92198dc6ba0ef28c7ec35eefc2120a85">UDPDiscard</a>();
<a name="l00050"></a>00050         }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         <span class="comment">//This task performs normal stack task including checking for incoming</span>
<a name="l00053"></a>00053         <span class="comment">//packet, type of packet and calling appropriate stack entity to</span>
<a name="l00054"></a>00054         <span class="comment">//process it.</span>
<a name="l00055"></a>00055         <a name="a128"></a><a class="code" href="stacktsk_8h.html#f08da4d2f3df4dd4c1779b43c118c88f">StackTask</a>();
<a name="l00056"></a>00056     }
<a name="l00057"></a>00057 }
</pre></div> <hr size="1"><address style="align: right;"><small>Generated on Mon Oct 9 11:35:13 2006 for SBC68EC Web Server by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.4.7 </small></address>
</body>
</html>
